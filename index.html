<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interactive Binomial p‑value Demo</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
  <style>
    :root{ --bg:#0b0f14; --panel:#111821; --ink:#e8eef6; --muted:#9bb0c9; --accent:#3ba8ff; --accent-2:#7cdb90; --warn:#ff7b7b; }
    html,body{height:100%}
    body{margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji; background:var(--bg); color:var(--ink)}
    .wrap{max-width:1100px; margin:24px auto; padding:0 16px 40px}
    .header{display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:16px}
    h1{font-size:20px; margin:0; font-weight:700; letter-spacing:0.2px}
    .card{background:var(--panel); border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .controls{display:grid; grid-template-columns:repeat(5, minmax(120px, 1fr)); gap:12px}
    .control{background:#0d131b; border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:10px 12px}
    .control label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    .control input[type="number"], .control select{width:100%}
    input, select{background:#0b1118; color:var(--ink); border:1px solid rgba(255,255,255,.08); border-radius:8px; padding:8px 10px}
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
    .pill{padding:8px 12px; border-radius:999px; background:#0b1118; border:1px solid rgba(255,255,255,.08); cursor:pointer; color:#fff}
    .pill:hover{border-color:var(--accent)}
    .stat{display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; margin-top:10px}
    .stat .box{background:#0d131b; border:1px solid rgba(255,255,255,.06); padding:10px; border-radius:12px}
    .box h3{margin:0; font-size:12px; color:var(--muted)}
    .box p{margin:6px 0 0; font-size:16px; font-weight:700}
    .legend{display:flex; gap:12px; align-items:center; flex-wrap:wrap; font-size:12px; margin:6px 0}
    .swatch{width:12px; height:12px; border-radius:2px; display:inline-block; margin-right:6px}
    .help{color:var(--muted); font-size:13px; line-height:1.5}
    .footer{margin-top:16px; font-size:12px; color:var(--muted)}
    @media (max-width: 980px){ .controls{grid-template-columns:repeat(2, minmax(120px, 1fr))} }
    canvas{width:100%; height:340px; max-height:640px}
    details{margin-top:16px}
    details pre{background:#0b1118; border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:12px; overflow:auto}
    .tiny{font-size:12px; color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <h1>For Tonia</h1>
      <div class="row">
        <button class="pill" id="btnEx7">Load badminton 7/10</button>
        <button class="pill" id="btnEx1">Load badminton 1/10</button>
        <button class="pill" id="btnShare">Copy shareable link</button>
      </div>
    </div>

    <div class="card" style="margin-bottom:16px">
      <div class="controls">
        <div class="control">
          <label>Null success rate, p₀ (%)</label>
          <input id="p0" type="number" min="0" max="100" step="0.1" value="80" />
        </div>
        <div class="control">
          <label>Sample size, n</label>
          <input id="n" type="number" min="1" max="1000" step="1" value="10" />
        </div>
        <div class="control">
          <label>Observed successes, k</label>
          <input id="k" type="number" min="0" max="10" step="1" value="7" />
        </div>
        <div class="control">
          <label>Significance, α</label>
          <input id="alpha" type="number" min="0.0001" max="0.5" step="0.0001" value="0.05" />
        </div>
        <div class="control">
          <label>Test</label>
          <select id="test">
            <option value="two">Two‑sided (H₁: p ≠ p₀)</option>
            <option value="left">Left‑tailed (H₁: p &lt; p₀)</option>
            <option value="right">Right‑tailed (H₁: p &gt; p₀)</option>
          </select>
        </div>
      </div>
      <div class="stat">
        <div class="box"><h3>Observed Z</h3><p id="zObs">—</p></div>
        <div class="box"><h3>p‑value</h3><p id="pVal">—</p></div>
        <div class="box"><h3>Critical Z</h3><p id="zCrit">—</p></div>
        <div class="box"><h3>Decision at α</h3><p id="decision">—</p></div>
      </div>
    </div>

    <div class="card">
      <div class="legend">
        <span class="swatch" style="background:#7cdb90"></span> Normal curve (approx)
        <span class="swatch" style="background:#ff7b7b"></span> Rejection region(s)
        <span class="swatch" style="background:#e8eef6"></span> Observed k
      </div>
      <canvas id="chart" height="260"></canvas>
      <div class="help" style="margin-top:8px">
        Visual shows the normal approximation to X∼Bin(n,p₀). Red shading marks rejection region/s based on Z cut‑offs for your α and test. The white marker is your observed k placed at the normal height.
      </div>
    </div>

    <div class="card">
      <details>
        <summary><strong>Self‑tests</strong> (numerical sanity checks)</summary>
        <pre id="testlog">Running…</pre>
        <div class="row"><button class="pill" id="btnRerun">Re‑run tests</button></div>
      </details>
    </div>

    <div class="footer">
      love u gangsta
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script>
    // ---- Normal utilities ----
    function normalPDF(x, mu, sd){ var z=(x-mu)/sd; return Math.exp(-0.5*z*z)/(sd*Math.sqrt(2*Math.PI)); }
    function normalCDF(z){ var t = 1/(1+0.2316419*Math.abs(z)); var d = Math.exp(-0.5*z*z)/Math.sqrt(2*Math.PI); var p = 1 - d*(0.319381530*t - 0.356563782*Math.pow(t,2) + 1.781477937*Math.pow(t,3) - 1.821255978*Math.pow(t,4) + 1.330274429*Math.pow(t,5)); return z>=0 ? p : 1-p; }
    function normalInv(p){ // Beasley‑Springer/Moro
      if(p<=0||p>=1) return NaN; var a=[2.50662823884,-18.61500062529,41.39119773534,-25.44106049637], b=[-8.47351093090,23.08336743743,-21.06224101826,3.13082909833], c=[0.3374754822726147,0.9761690190917186,0.1607979714918209,0.0276438810333863,0.0038405729373609,0.0003951896511919,0.0000321767881768,0.0000002888167364,0.0000003960315187]; var x=p-0.5; if(Math.abs(x)<0.42){ var r=x*x; var num=a[0]+a[1]*r+a[2]*r*r+a[3]*r*r*r; var den=1+b[0]*r+b[1]*r*r+b[2]*r*r*r+b[3]*r*r*r*r; return x*num/den; } var r=p; if(x>0) r=1-p; r=Math.log(-Math.log(r)); var z=c[0]+r*(c[1]+r*(c[2]+r*(c[3]+r*(c[4]+r*(c[5]+r*(c[6]+r*(c[7]+r*c[8]))))))); return x<0?-z:z; }

    var ctx=document.getElementById('chart').getContext('2d');
    var chart;

    function fmt(x){ if(!isFinite(x)) return '—'; return (Math.abs(x)>=100? x.toFixed(1) : Math.abs(x)>=10? x.toFixed(2) : x.toFixed(3)); }
    function fmtP(p){ if(!isFinite(p)) return '—'; if(p<1e-6) return p.toExponential(2); if(p<0.001) return p.toExponential(2); return p.toFixed(6).replace(/0+$/,'').replace(/\.$/,''); }

    function buildCurves(n,p0){ var mu=n*p0, sd=Math.sqrt(n*p0*(1-p0))||1; var nx=600,x=[],y=[]; var minX=-0.5,maxX=n+0.5; for(var i=0;i<nx;i++){ var xi=minX+(maxX-minX)*i/(nx-1); x.push(xi); y.push(normalPDF(xi,mu,sd)); } return {x:x,y:y,mu:mu,sd:sd,minX:minX,maxX:maxX}; }

    function compute(){
      var p0=Math.max(0,Math.min(1,parseFloat(document.getElementById('p0').value)/100));
      var n=Math.max(1,Math.min(1000,parseInt(document.getElementById('n').value)));
      var kI=Math.max(0,Math.min(n,parseInt(document.getElementById('k').value)));
      var alpha=Math.max(1e-6,Math.min(0.5,parseFloat(document.getElementById('alpha').value)));
      var test=document.getElementById('test').value;

      var mu=n*p0, sd=Math.sqrt(n*p0*(1-p0));
      var zObs=(kI-mu)/sd;

      // Z criticals
      var zL=null, zR=null;
      if(test==='left'){ zL=normalInv(alpha); }
      else if(test==='right'){ zR=normalInv(1-alpha); }
      else { zL=normalInv(alpha/2); zR=normalInv(1-alpha/2); }

      // p‑value from Z
      var pVal;
      if(test==='left')      pVal = normalCDF(zObs);
      else if(test==='right') pVal = 1 - normalCDF(zObs);
      else                    pVal = 2 * Math.min(normalCDF(zObs), 1 - normalCDF(zObs));

      // Update stats panel
      document.getElementById('zObs').textContent = fmt(zObs);
      var zCritText = (test==='two') ? ('±' + fmt(Math.abs(zL))) : (fmt(zL||zR));
      document.getElementById('zCrit').textContent = zCritText;
      document.getElementById('pVal').textContent = fmtP(pVal);
      var reject=false;
      if(test==='left')      reject = (zObs <= zL);
      else if(test==='right') reject = (zObs >= zR);
      else                    reject = (zObs <= zL) || (zObs >= zR);
      document.getElementById('decision').textContent = reject? 'Reject H₀' : 'Do not reject';

      // Build chart datasets (normal-only with Z cut‑off shading)
      var c=buildCurves(n,p0); var x=c.x,y=c.y;
      var xCutL = (zL!=null) ? (mu + sd*zL) : null;
      var xCutR = (zR!=null) ? (mu + sd*zR) : null;

      function maskLeft(xs,ys){ return xs.map(function(xi,i){ return (xCutL!=null && xi<=xCutL)? ys[i]:null; }); }
      function maskRight(xs,ys){ return xs.map(function(xi,i){ return (xCutR!=null && xi>=xCutR)? ys[i]:null; }); }
      var yLeft  = (test==='left'||test==='two') ? maskLeft(x,y)  : new Array(y.length).fill(null);
      var yRight = (test==='right'||test==='two')? maskRight(x,y) : new Array(y.length).fill(null);

      var yk = normalPDF(kI, mu, sd);

      var datasets=[
        {type:'line',label:'Normal approx',data:x.map(function(xi,idx){ return {x:xi,y:y[idx]};}),parsing:false,borderColor:'#7cdb90',borderWidth:2,tension:0.15,pointRadius:0,fill:false,yAxisID:'y'},
        {type:'line',label:'Rejection (left)',data:x.map(function(xi,idx){ return {x:xi,y:yLeft[idx]};}),parsing:false,borderColor:'transparent',backgroundColor:'rgba(255,123,123,0.35)',fill:'origin',tension:0.15,pointRadius:0,yAxisID:'y',hidden:yLeft.every(function(v){return v===null;})},
        {type:'line',label:'Rejection (right)',data:x.map(function(xi,idx){ return {x:xi,y:yRight[idx]};}),parsing:false,borderColor:'transparent',backgroundColor:'rgba(255,123,123,0.35)',fill:'origin',tension:0.15,pointRadius:0,yAxisID:'y',hidden:yRight.every(function(v){return v===null;})},
        {type:'line',label:'Observed k',data:[{x:kI,y:0},{x:kI,y:yk}],parsing:false,borderColor:'#e8eef6',borderWidth:1.5,pointRadius:0,yAxisID:'y'},
        {type:'scatter',label:'Observed k (point)',data:[{x:kI,y:yk}],parsing:false,pointRadius:6,pointBackgroundColor:'#e8eef6',pointBorderColor:'#e8eef6',showLine:false,yAxisID:'y'}
      ];

      var options={responsive:true,maintainAspectRatio:false,animation:false,scales:{x:{type:'linear',min:c.minX,max:c.maxX,grid:{color:'rgba(255,255,255,.06)'},ticks:{stepSize:1,callback:function(v){return Number.isInteger(v)? v : '';}},title:{display:true,text:'k (successes)'}},y:{beginAtZero:true,grid:{color:'rgba(255,255,255,.06)'},title:{display:true,text:'Probability density (normal approx)'}}},plugins:{legend:{labels:{color:'#e8eef6'}}}};

      if(chart){ chart.data={datasets:datasets}; chart.options=options; chart.update(); }
      else{ chart=new Chart(ctx,{type:'line',data:{datasets:datasets},options:options}); }
    }

    ['p0','n','k','alpha','test'].forEach(function(id){ document.getElementById(id).addEventListener('input',compute); document.getElementById(id).addEventListener('change',compute); });

    document.getElementById('btnEx7').addEventListener('click',function(){ document.getElementById('p0').value=80; document.getElementById('n').value=10; document.getElementById('k').value=7; document.getElementById('alpha').value=0.05; document.getElementById('test').value='two'; compute(); });
    document.getElementById('btnEx1').addEventListener('click',function(){ document.getElementById('p0').value=80; document.getElementById('n').value=10; document.getElementById('k').value=1; document.getElementById('alpha').value=0.05; document.getElementById('test').value='two'; compute(); });
    document.getElementById('btnShare').addEventListener('click',function(){ try{ navigator.clipboard.writeText(location.href).then(function(){ alert('Link copied! Paste into a Notion embed.'); }); } catch(e){ alert('Copy failed. Manually copy the URL.'); } });

    // --- Self‑tests ---
    function approxEq(a,b,eps){ return Math.abs(a-b) <= eps; }
    function log(line){ var el=document.getElementById('testlog'); el.textContent += '\n' + line; }
    function clearLog(){ var el=document.getElementById('testlog'); el.textContent=''; }
    function runTests(){
      clearLog(); var pass=true; function t(name, ok){ log((ok?'✅ ':'❌ ') + name); if(!ok) pass=false; }
      // Sanity: n=10, p0=0.8, k=7 → z ≈ -0.7906; two‑sided p ≈ 0.4298
      var n1=10,p01=0.8,k1=7, mu1=n1*p01, sd1=Math.sqrt(n1*p01*(1-p01));
      var z1=(k1-mu1)/sd1; var p1=2*Math.min(normalCDF(z1),1-normalCDF(z1));
      t('z(10,0.8,7) ≈ -0.791', approxEq(z1,-0.7906,1e-3));
      t('two‑sided p ≈ 0.43', approxEq(p1,0.4298,5e-3));
      // Sanity: n=10, p0=0.8, k=1 → very small p
      var k2=1; var z2=(k2-mu1)/sd1; var p2=2*Math.min(normalCDF(z2),1-normalCDF(z2));
      t('two‑sided p(1) small', p2 < 1e-6);
      log('\n' + (pass? 'All tests passed ✅' : 'Some tests failed ❌'));
    }

    document.getElementById('btnRerun').addEventListener('click', runTests);

    compute();
    runTests();
  </script>
</body>
</html>
